!function(e){window.crud_ajax_setup=function(){e.ajaxSetup({headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}})},window.setAlertDeleteObject=function(e,t){return{title:e,text:t,icon:"warning",buttons:!0,dangerMode:!0}},window.setAlertObject=function(e,t,a="success",i=!1){return{title:e,text:t,icon:a,buttons:!0,dangerMode:i}},crud_ajax_setup();let t=e('meta[name="http-root"]').attr("content"),a=e("html").attr("lang"),i="en"===a?"toast-top-right":"toast-top-left";toastr.options={closeButton:!1,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:i,preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},e("body").on("submit","form.ajax",function(i){i.preventDefault();let n=e(this),s=e("input[type=submit]");s.attr("disabled",!0),n.prop("disabled","true");let r=e(".progress-bar"),l=e(".progress");e(".js-ckeditor").length&&e.each(CKEDITOR.instances,function(e,t){t.updateElement()});let o=e(n.find(":input.form-data")),d=new FormData;return o.each(function(t,a){let i=e(a);if("file"===i.attr("type")&&i.attr("name").indexOf("[]")>=0)if(i[0].files[0])for(let e=0;e<i[0].files.length;e++)d.append(i.attr("name"),i[0].files[e]);else d.append(i.attr("name"),i.val());else if("file"===i.attr("type"))i.val()&&d.append(i.attr("name"),i[0].files[0]);else if("select-multiple"===i[0].type){if(i.val())for(let e=0;e<i.val().length;e++)d.append(i.attr("name"),i.val()[e])}else"radio"===i[0].type||"checkbox"===i[0].type?i.is(":checked")?d.append(i.attr("name"),i.val()):"checkbox"===i[0].type&&d.append(i.attr("name"),""):d.append(i.attr("name"),i.val())}),n.find('input[name="_method"]').length&&d.append("_method",n.find('input[name="_method"]').val()),n.find('input[name="_token"]').length&&d.append("_token",n.find('input[name="_token"]').val()),e(".flash-messages").remove(),e("#ajax-messages").html(""),e(".val-error").remove(),e(".nav-tab-title-js").removeClass("text-danger"),e(".is-invalid").removeClass("is-invalid"),e(".select2-selection.select2-selection--single").css("border",""),e("div.dropify-wrapper").css("border-color",""),e("form.ajax").ajaxSubmit({beforeSubmit:function(e,t,a){HoldOn.open()},beforeSend:function(){},uploadProgress:function(e,t,a,i){HoldOn.close(),l.fadeIn(),r.css("width",i+"%"),r.html(i+"%")},success:function(i){if(i.requestStatus){if(n.hasClass("edit")){if(void 0!==i.data){let t=i.data;void 0!==t.images&&e.each(t.images,function(a,i){if("single"===i.type){if(i.imageName){let t=e('input[name="'+a+'"]').parents("div.img-media").find("div.img-container");if(t.find("a.single-image").length){let e=n.find("img."+a+"-small-image");e.data("imgName")!==i.imageName&&(e.attr("src",i.smImgUrl),e.data("imgName",i.imageName),e.parent("a.single-image").data("imgHref",i.imageHref))}else{let e=`\n                                                    <a\n                                                        class='single-image'\n                                                        style='cursor: pointer;'\n                                                        data-popup='tooltip'\n                                                        data-img-href='${i.imageHref}'\n                                                        data-placement='bottom'\n                                                        data-original-title='View'>\n\n                                                        <img src='${i.smImgUrl}' data-img-name='${i.imageName}' class='${a}-small-image img-responsive' alt="">\n                                                    </a>\n                                                `;t.html(e)}n.hasClass("admin-profile")&&"image"===a&&e("div.side-header img.profile-img").attr("src",i.sideImgUrl)}}else if("multiple"===i.type){let i=a+"[]";Object.keys(t.images[a].images).length&&e.each(t.images[a].images,function(n,s){let r=e('input[name="'+i+'"]').siblings("input#"+a+"-href").val()+"/"+n;if(0===e("#"+a+"-additional-images img#img-"+n).length){let i=`\n                                                            <div class="col-xs-4 gallery-img-${n}">\n                                                                <a class='img-link additional-imgs-item' data-img-href = '${r}' data-img-id='${n}' data-popup='tooltip' data-popup='tooltip' data-placement='bottom' data-original-title='View' style="cursor: pointer;">\n                                                                    <img class="img-responsive" id='img-${n}' src='${t.images[a].thumbUrl}/${s}' >\n                                                                </a>\n                                                            </div>`;e("#"+a+"-additional-images").find(".js-gallery").append(i)}})}e('[data-popup="tooltip"]').tooltip()}),n.hasClass("admin-profile")&&e("div.side-header .profile-name").html(n.find("input[name=name]").val()),n.find("input[type=password]").val("")}toastr.success(i.message)}else n.trigger("reset"),e(".dropify-preview").css("display","none"),e("div.dropify-wrapper").css("border-color",""),n.find("select").val("").trigger("change"),e(".js-ckeditor").length&&e.each(CKEDITOR.instances,function(e,t){t.setData("")}),void 0!==i.redirect?window.location=t+"/"+a+"/"+i.redirect:(e("#ajax-messages").html("<div class='alert alert-success alert-styled-left alert-arrow-left alert-bordered'><button type='button' class='close' data-dismiss='alert'><span>×</span><span class='sr-only'>Close</span></button><p>"+i.message+"</p></div>"),e("html, body").animate({scrollTop:0},"slow"));if(n.find('input[type="file"]').length){n.find('input[type="file"]').val("");let e=n.find('input[type="file"]').parents(".form-group").find("span.filename");for(let t=0;t<e.length;t++)n.find('input[type="file"]').parents(".form-group").find("span.filename")[t].innerHTML="No file selected"}}else crud_handle_server_errors(i,n)},error:e=>crud_handle_server_errors(e,n),complete:e=>{l.fadeOut(),s.attr("disabled",!1),HoldOn.close()}}),!1}),window.crud_handle_validation_errors=function(t,i=null){toastr.error("ar"===a?"خطأ في المدخلات":"Validation error");let n=t.responseJSON.errors;e.each(n,function(t,a){let n=null!=i?i.find(':input[name="'+t+'"]'):e(':input[name="'+t+'"]');if(0===n.length&&(n=e(':input[name="'+t+'[]"]')),0===n.length&&-1!==t.indexOf(".")){let a=t.split("."),s="";for(let e=0;e<a.length;e++)s+=0!==e?"["+a[e]+"]":a[e];n=null!=i?i.find(':input[name="'+s+'"]'):e(':input[name="'+s+'"]')}if(n.length){if("TEXTAREA"===n[0].nodeName)n.parent("div.form-valid").children("TEXTAREA").addClass("is-invalid"),n.parent("div.form-valid ").after("<div class='help-block text-right animated fadeInDown val-error'>"+a[0]+"</div>");else if("file"===n.attr("type")){let t=e(".dropify-errors-container");t.html(""),t.append(`<ul><li>${a[0]}</li></ul>`),n.val(""),n.parent().css("border-color","red")}else"SELECT"===n[0].nodeName?(n.parent("div.form-valid").children().children().children().css("border","1px solid red"),n.parent("div.form-valid ").after("<div class='help-block text-right animated fadeInDown val-error'>"+a[0]+"</div>")):(n.parent("div.form-valid").children("input").addClass("is-invalid"),n.hasClass("js-colorpicker")?n.parents("div.js-colorpicker ").after("<div class='help-block text-right animated fadeInDown val-error' style='color:#d26a5c;'>"+a[0]+"</div>"):n.parent("div.form-valid ").after("<div class='help-block text-right animated fadeInDown val-error'>"+a[0]+"</div>"));if(n.parents(".nav-tabs").length){let t=n.parents(".nav-tabs"),a=e('a[href="#'+e(t[0]).attr("id")+'"]');a.find(".nav-tab-title-js").css("border","2px solid red"),0===a.find(".val-error-icon").length&&a.find(".nav-tab-title-js").after(' <i class="fa fa-exclamation-circle text-danger is-invalid val-error-icon"></i>')}}else console.log(t+" input not found to show its error validation")})},e(".table-delete-action").on("click",".delete-action",function(){let t=e(this),a=t.parents("table").dataTable();return bootbox.confirm({title:"<div class='text-center'>"+Lang.get("responseMessages.confirmation")+"</div>",message:"<div>"+Lang.get("responseMessages.confirm-deletion")+"</div>",buttons:{cancel:{label:'<i class="fa fa-times"></i> '+Lang.get("responseMessages.cancel")},confirm:{label:'<i class="fa fa-check"></i> '+Lang.get("responseMessages.confirm"),className:"btn-danger"}},callback:function(i){i&&e.ajax({url:t.attr("href"),method:"POST",data:{_method:"DELETE"},success:function(i){if(i.deleteStatus){t.parents("tr").fadeOut("slow",function(){a.fnDeleteRow(e(this))})}else{var n=i.error;bootbox.alert({size:"small",title:"<p class='text-danger'>"+Lang.get("responseMessages.error")+"</p>",message:"<p class='text-danger'>"+n+"<p>",buttons:{ok:{label:'<i class="fa fa-check"></i> '+Lang.get("responseMessages.cancel")}}})}},error:e=>crud_handle_server_errors(e),complete:function(e){}})}}),!1}),window.crud_handle_server_errors=function(e,t=null){switch(e.status){case 422:crud_handle_validation_errors(e,t);break;case 401:toastr.error(e.message?e.message:"Unauthenticated");break;case 403:toastr.error(e.message?e.message:"You do not have the permission to do that");break;case 419:toastr.error("Token Expired, Please refresh the page.");break;case 500:toastr.error("Server Error");break;default:toastr.error(e.message?e.message:"Something happen wrong")}}}(jQuery);
